<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>APP Generador de Publicación Instagram Andre Store</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&display=swap" rel="stylesheet">
<style>
  body { font-family:'Poppins',sans-serif; display:flex; flex-direction:column; align-items:center; background:#f0f0f0; margin:0; padding:20px; }
  .controls { display:flex; flex-direction:column; gap:10px; width:90%; max-width:400px; margin-bottom:20px; background:rgba(255,255,255,0.95); padding:12px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2); }
  .controls label { display:flex; flex-direction:column; font-weight:600; }
  .controls input[type="text"], .controls input[type="file"] { margin-top:4px; padding:6px 8px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
  .preview { width:80px; height:80px; object-fit:cover; border-radius:10px; border:2px solid #ccc; margin-top:5px; display:none; }
  .size-buttons { display:flex; flex-wrap:wrap; gap:8px; margin-top:5px; justify-content:center; }
  .size-buttons button { padding:8px 14px; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(45deg,#ff66b2,#66e0ff); color:white; font-weight:bold; transition:transform 0.2s, background 0.3s; flex:1 1 30%; }
  .size-buttons button:hover { transform:scale(1.05); background:linear-gradient(45deg,#ff3399,#33ccff); }
  .size-buttons button.active { background:#ff33cc; color:white; }
  #generarBtn, #descargarBtn { padding:10px 16px; font-size:16px; border:none; cursor:pointer; border-radius:8px; font-weight:bold; margin-top:10px; color:white; }
  #generarBtn { background:#ff69b4; }
  #generarBtn:hover { background:#ff1493; }
  #descargarBtn { background:#32cd32; }
  #descargarBtn:hover { background:#28a428; }
  canvas { width:90vw; max-width:1080px; aspect-ratio:1/1; border-radius:12px; display:block; border:2px solid #ddd; box-shadow:0 4px 10px rgba(241, 194, 218, 0.8); background:#fff; }

  /* Switch CSS */
  .switch { position: relative; display: inline-block; width:60px; height:28px; }
  .switch input { display:none; }
  .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#ccc; transition:0.4s; border-radius:28px; }
  .slider:before { position:absolute; content:""; height:22px; width:22px; left:3px; bottom:3px; background-color:white; transition:0.4s; border-radius:50%; }
  input:checked + .slider { background-color:#6666ff; }
  input:checked + .slider:before { transform:translateX(32px); }
</style>
</head>
<body>

<div class="controls">
  <label>Subir imagen del Vestido de Baño
    <input type="file" id="productoInput" accept="image/*">
  </label>
  <img id="preview" class="preview" src="" alt="Vista previa">
  <label>Código
    <input type="text" id="codigo" placeholder="Ejemplo: ABC123">
  </label>
  Escoja la Talla
  <div class="size-buttons">
    <button onclick="selectSize(this,'Niña')">Niña</button>  
    <button onclick="selectSize(this,'Juvenil')">Juvenil</button>
    <button onclick="selectSize(this,'XS')">XS</button>
    <button onclick="selectSize(this,'S')">S</button>
    <button onclick="selectSize(this,'M')">M</button>
    <button onclick="selectSize(this,'L')">L</button>
    <button onclick="selectSize(this,'XL')">XL</button>
    <button onclick="selectSize(this,'Plus')">Plus</button>
    <button onclick="selectSize(this,'Plus 1X')">Plus 1X</button>
    <button onclick="selectSize(this,'Plus 2X')">Plus 2X</button>
    <button onclick="selectSize(this,'Plus 3X')">Plus 3X</button>
  </div>

  <!-- Toggle marco con texto -->
  <label style="display:flex; align-items:center; gap:10px; margin-top:10px;">
    <span>Marco</span>
    <label class="switch">
      <input type="checkbox" id="toggleMarco" checked>
      <span class="slider"></span>
    </label>
  </label>

  <button id="generarBtn">Generar Post</button>
  <button id="descargarBtn">Descargar Imagen</button>
</div>

<canvas id="canvas" width="1080" height="1080"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const preview = document.getElementById("preview");
const toggleMarco = document.getElementById("toggleMarco");
let tallaSeleccionada = "";

// Mostrar preview
document.getElementById('productoInput').addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(event){
      preview.src = event.target.result;
      preview.style.display="block";
    };
    reader.readAsDataURL(file);
  }
});

// Seleccionar talla
function selectSize(button,talla){
  document.querySelectorAll(".size-buttons button").forEach(b=>b.classList.remove("active"));
  button.classList.add("active");
  tallaSeleccionada = talla;
}

// Generar imagen
document.getElementById('generarBtn').addEventListener('click', ()=>{
  const fileInput = document.getElementById('productoInput');
  const codigo = document.getElementById('codigo').value.trim();
  if(!fileInput.files[0] || !codigo || !tallaSeleccionada) return;

  const productoFile = fileInput.files[0];
  const readerProducto = new FileReader();
  readerProducto.onload = function(eProducto){
    const imgProducto = new Image();
    imgProducto.onload = function(){
      const fondo = new Image();
      fondo.src = './fondo.png';
      fondo.onload = function(){ dibujarCanvas(imgProducto, fondo); }
      fondo.onerror = function(){ dibujarCanvas(imgProducto, null); }
    };
    imgProducto.src = eProducto.target.result;
  };
  readerProducto.readAsDataURL(productoFile);
});

function dibujarCanvas(imgProducto, fondo){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(fondo){
        ctx.drawImage(fondo,0,0,canvas.width,canvas.height);
    } else {
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    // Dimensiones del producto
    const maxH = canvas.height * 0.97;
    const maxW = canvas.width * 0.83;
    const scale = Math.min(maxW / imgProducto.width, maxH / imgProducto.height) * 0.85;
    const w = imgProducto.width * scale;
    const h = imgProducto.height * scale;
    const x = (canvas.width - w) / 2;
    const y = (canvas.height - h) / 2 - canvas.height * 0.07;

    // --- MARCO BLANCO DETRÁS (si toggle activado) ---
    if(toggleMarco.checked){
        const radius = 22;
        const marco = 14;
        ctx.save();
        ctx.fillStyle = "#ffffff";
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.shadowBlur = 26;
        ctx.shadowOffsetX = 8;
        ctx.shadowOffsetY = 8;
        ctx.beginPath();
        ctx.moveTo(x - marco + radius, y - marco);
        ctx.lineTo(x + w + marco - radius, y - marco);
        ctx.quadraticCurveTo(x + w + marco, y - marco, x + w + marco, y - marco + radius);
        ctx.lineTo(x + w + marco, y + h + marco - radius);
        ctx.quadraticCurveTo(x + w + marco, y + h + marco, x + w + marco - radius, y + h + marco);
        ctx.lineTo(x - marco + radius, y + h + marco);
        ctx.quadraticCurveTo(x - marco, y + h + marco, x - marco, y + h + marco - radius);
        ctx.lineTo(x - marco, y - marco + radius);
        ctx.quadraticCurveTo(x - marco, y - marco, x - marco + radius, y - marco);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
    }

    // Imagen del producto
    const radius = 22;
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + w - radius, y);
    ctx.quadraticCurveTo(x + w, y, x + w, y + radius);
    ctx.lineTo(x + w, y + h - radius);
    ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
    ctx.lineTo(x + radius, y + h);
    ctx.quadraticCurveTo(x, y + h, x, y + h - radius);
    ctx.lineTo(x, y + radius);
    ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();
    ctx.clip();
    ctx.drawImage(imgProducto, x, y, w, h);
    ctx.restore();

    // Texto talla
    ctx.save();
    ctx.font = '800 65px Poppins';
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    const grad = ctx.createLinearGradient(0,0,canvas.width,0);
    grad.addColorStop(0,"#ffaadf");
    grad.addColorStop(1,"#e75480");
    ctx.fillStyle = grad;
    ctx.strokeStyle = "#ffffff";
    ctx.lineWidth = 8;
    ctx.shadowColor = "rgba(0,0,0,0.5)";
    ctx.shadowBlur = 10;
    ctx.shadowOffsetX = 4;
    ctx.shadowOffsetY = 4;
    const textoTalla = "Talla " + tallaSeleccionada;
    ctx.strokeText(textoTalla, canvas.width/2, canvas.height*0.92);
    ctx.fillText(textoTalla, canvas.width/2, canvas.height*0.92);
    ctx.restore();

    // Texto código
    ctx.save();
    ctx.font = 'bold 10px Poppins';
    ctx.fillStyle = "pink";
    ctx.textAlign = "left";
    ctx.textBaseline = "top";
    let codigoTexto = document.getElementById('codigo').value.trim();
    ctx.fillText("Código", 30, 35);
    ctx.fillText(codigoTexto, 30, 53);
    ctx.restore();
}

// Descargar imagen
document.getElementById('descargarBtn').addEventListener('click', ()=>{
    if (!tallaSeleccionada || !document.getElementById('codigo').value.trim()) return;
    const codigo = document.getElementById('codigo').value.trim();
    const fecha = new Date();
    const fechaStr = fecha.getFullYear() + ('0'+(fecha.getMonth()+1)).slice(-2) + ('0'+fecha.getDate()).slice(-2);
    const nombreArchivo = `${tallaSeleccionada}+${codigo}+${fechaStr}.png`;
    const link = document.createElement('a');
    link.download = nombreArchivo;
    link.href = canvas.toDataURL('image/png');
    link.click();
});
</script>

</body>
</html>

