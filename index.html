<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>APP Generador de Publicación Instagram Andre Store</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
/* --- VARIABLES --- */
:root {
    --rosa-principal: #ff69b4;
    --rosa-hover: #ff1493;
    --coral-principal: #ff7f50;
    --coral-hover: #ff4500;
    --verde-principal: #32cd32;
    --verde-hover: #28a428;
    --texto: #222;
}

/* --- ESTILOS GENERALES --- */
body { 
    font-family:'Poppins',sans-serif; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    justify-content:flex-start;
    background: url('inicio.png') no-repeat center center fixed;
    background-size: cover;
    margin:0; 
    min-height:100vh;
    padding: 16px;
    box-sizing: border-box;
}

body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.85);
    z-index:-1;
}

.pantalla {
    text-align:center;
    background:rgba(255,255,255,0.92);
    backdrop-filter: blur(6px);
    padding:24px;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.18);
    max-width:1100px;
    width:100%;
    margin: 16px auto;
    box-sizing: border-box;
}
.pantalla h1 { color:#ff0482; margin:0 0 1px 0; font-weight:800; font-size: 1.5rem; }
.pantalla p { margin-bottom:22px; font-size:16px; color:#444; }
.pantalla h2 { color:#ff69b4; margin:0 0 1px 0; font-weight:800; font-size: 1.5rem; }
.pantalla p { margin-bottom:18px; font-size:16px; color:#444; }

input[type="text"], input[type="password"] {
    width:100%; 
    padding:12px 14px; 
    margin:8px 0;
    border-radius:12px; 
    border:1px solid #ccc; 
    font-size:15px;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.08);
    transition: border .2s, box-shadow .2s;
    box-sizing: border-box;
}

input[type="text"]:focus, input[type="password"]:focus {
    border-color: var(--rosa-principal);
    box-shadow: 0 0 8px rgba(255,105,180,0.4);
    outline:none;
}

button { 
    padding:12px 20px; 
    border:none; 
    border-radius:12px;
    font-size:16px; 
    font-weight:600; 
    cursor:pointer;
    background:linear-gradient(45deg,#ff66b2,#66e0ff);
    color:white; 
    transition:transform 0.25s, background 0.25s, box-shadow 0.25s;
    min-width: 120px;
}

button:hover { 
    transform:translateY(-1px); 
    background:linear-gradient(45deg,#ff3399,#33ccff); 
    box-shadow: 0 6px 14px rgba(0,0,0,0.18);
}

#login, #app { display:none; }
.login-img { width:70%; max-width:240px; margin:0 auto 16px auto; display:block; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); }

.controls { 
    display:flex; 
    flex-direction:column; 
    gap:14px;
    width:100%; 
    max-width:520px; 
    background:rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    padding:20px; 
    border-radius:18px; 
    box-shadow:0 10px 24px rgba(0,0,0,0.18);
    margin: 10px auto 14px auto;
    box-sizing: border-box;
}

.controls .grupo { 
    display:flex; 
    flex-direction:column; 
    gap:8px; 
    text-align:center;  /* CENTRADO */
}

.controls label span, .controls .label-standalone {
    font-weight:600; 
    color:var(--texto); 
    font-size:15px;
    display:block;
}

/* input file y preview */
.controls input[type="file"], .controls input[type="text"] {
    width:100%; 
    padding:12px 14px;
    border-radius:12px; 
    border:1px solid #ccc; 
    font-size:15px;
    background:#fff; 
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.06);
    box-sizing: border-box;
}

.controls input[type="file"]::file-selector-button{
    margin-right: 10px;
    border:none; 
    border-radius:10px;
    padding:8px 12px; 
    font-weight:600; 
    background: linear-gradient(45deg,#ff66b2,#66e0ff);
    color:#fff; 
    cursor:pointer;
}

.controls input[type="file"]::file-selector-button:hover{
    background: linear-gradient(45deg,#ff3399,#33ccff);
}

.preview { 
    width:120px; 
    height:120px; 
    object-fit:cover; 
    border-radius:12px; 
    border:2px solid #e8d6e0; 
    display:none; 
}

/* size buttons */
.size-buttons { 
    display:flex; 
    flex-wrap:wrap; 
    gap:8px; 
    margin-top:2px; 
}

.size-buttons button { 
    padding:10px 12px; 
    border:none; 
    border-radius:12px; 
    cursor:pointer; 
    background:linear-gradient(45deg,#ff66b2,#66e0ff); 
    color:white; 
    font-weight:700; 
    transition:transform 0.2s, filter 0.2s;
    flex: 1 1 calc(25% - 8px);
    min-width: 70px;
    font-size: 14px;
}

.size-buttons button:hover { 
    transform:translateY(-1px); 
    filter:brightness(1.05); 
}

.size-buttons button.active { 
    background:#ff33cc; 
}

/* switch */
.switch { 
    position: relative; 
    display: inline-block; 
    width:60px; 
    height:28px; 
}
.switch input { display:none; }
.slider { position:absolute; cursor:pointer; inset:0; background-color:#ccc; transition:0.3s; border-radius:28px; }
.slider:before { content:""; position:absolute; height:22px; width:22px; left:3px; bottom:3px; background:#fff; transition:0.3s; border-radius:50%; }
input:checked + .slider { background-color:#6666ff; }
input:checked + .slider:before { transform:translateX(32px); }

/* Contenedor de canvases */
#contenedorCanvases{ 
    display: flex;
    flex-direction: column;
    gap: 30px;
    margin: 8px auto 24px auto; 
    width:100%; 
    max-width:1020px; 
}

.canvas-row {
    display: flex;
    flex-direction: column;
    width: 100%;
    margin-bottom: 30px;
}

.canvas-row-title {
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 15px;
    padding: 8px 15px;
    border-radius: 10px;
    display: inline-block;
    align-self: center;
}

.feed-title {
    color: #54f983;
    background-color: rgba(84, 249, 131, 0.1);
}

.historia-title {
    color: #e98e1e;
    background-color: rgba(233, 142, 30, 0.1);
}

.canvas-scroll-container {
    width: 100%;
    overflow-x: auto;
    padding: 10px 0;
}

.canvas-horizontal-container {
    display: flex;
    gap: 20px;
    padding: 10px;
}

.canvas-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(255,255,255,0.8);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    min-width: 350px;
}

canvas { 
    border-radius:12px; 
    border:2px solid #eee; 
    box-shadow:0 6px 14px rgba(241,194,218,0.6); 
    max-width:100%; 
    height:auto; 
}

/* --- BOTONES DE ACCIÓN --- */
.fila-actions { 
    display:flex; 
    gap:10px; 
    flex-wrap:nowrap; 
    justify-content:space-between; 
}

#generarAmbosBtn, #descargarTodoBtn, #descargarFeedBtn, #descargarHistoriaBtn { 
    flex: 1 1 32%;
    color:#fff; 
    border-radius:12px; 
    font-weight:800;
    margin: 0;
}

#generarAmbosBtn { background:var(--rosa-principal); }
#generarAmbosBtn:hover { background:var(--rosa-hover); }

#descargarTodoBtn { background:var(--verde-principal); }
#descargarTodoBtn:hover { background:var(--verde-hover); }

#descargarFeedBtn { background:var(--coral-principal); }
#descargarFeedBtn:hover { background:var(--coral-hover); }

#descargarHistoriaBtn { background:var(--coral-principal); }
#descargarHistoriaBtn:hover { background:var(--coral-hover); }

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
    .fila-actions { flex-direction: column; }
    #generarAmbosBtn, #descargarTodoBtn, #descargarFeedBtn, #descargarHistoriaBtn { width:100%; flex:unset; margin-bottom:6px; }
    
    .canvas-container {
        min-width: 300px;
    }
}
.titulo-label span {
  font-weight: 800;        /* mismo peso que el h2 */
  color: #ff0080;          /* mismo color que el h2 */
  font-size: 1.1rem;       /* un poco más pequeño que h2 */
  display: block;
  margin-bottom: 6px;      /* espacio entre el texto y el input */
  text-align: center;      /* centrado como antes */
}
.titulo-label2 span {
  font-weight: 600;        /* mismo peso que el h2 */
  color: #ff0080;          /* mismo color que el h2 */
  font-size: 1rem;       /* un poco más pequeño que h2 */
  display: block;
  margin-bottom: 8px;      /* espacio entre el texto y el input */
  text-align: center;      /* centrado como antes */
}
#codigo {
  width: 250px;                  /* Ancho del input */
  padding: 10px 15px;            /* Espacio interno */
  border: 2px solid #ff0080;     /* Borde rosa */
  border-radius: 12px;             /* Bordes redondeados */
  font-size: 16px;                /* Tamaño de letra */
  font-family: 'Poppins', sans-serif;
  outline: none;                  /* Quita borde por defecto al enfocar */
  transition: all 0.3s ease;     /* Transición suave */
  box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Sombra suave */
}

#codigo::placeholder {
  color: #c4709a;                /* Color del placeholder */
  opacity: 0.7;                   /* Leve transparencia */
  font-style: italic;             /* Cursiva para estilo */
}

#codigo:focus {
  border-color: #6666ff;         /* Cambia color del borde al enfocar */
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.image-upload-container {
  display: flex;
  flex-direction: column;
  align-items: center;       /* Centra todo horizontalmente */
  gap: 15px;                 /* Espacio entre input y preview */
  margin-top: 20px;
}

.custom-file-label {
  display: inline-block;
  padding: 10px 20px;
  background-color: #c4709a; /* Color rosa */
  color: #fff;
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.custom-file-label:hover {
  background-color: #ff85b5; /* Cambio al pasar el mouse */
}

.custom-file-label input {
  display: none; /* Oculta el input real */
}

.preview {
  width: 250px;               /* Ancho de la imagen */
  max-width: 90%;             /* Se adapta a móviles */
  height: 250px;              /* Altura fija para consistencia */
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  object-fit: contain;        /* Muestra toda la imagen sin recortar */
  background-color: #f5f5f5; /* Fondo suave para que se vea la imagen completa */
  padding: 5px;               /* Espacio interno para que no toque los bordes */
}

/* --- ZOOM SLIDER --- */
.zoom-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 12px;
    margin-bottom: 12px;
    width: 100%;
    max-width: 320px;
    margin-left: auto;
    margin-right: auto;
}
.zoom-container label {
    font-weight: 600;
    color: #555;
    font-size: 15px;
}
.zoom-container input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 8px;
    background: #ddd;
    outline: none;
    opacity: 0.9;
    transition: opacity .2s;
    border-radius: 8px;
}
.zoom-container input[type="range"]:hover {
    opacity: 1;
}
.zoom-container input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: var(--rosa-principal);
    cursor: pointer;
    border-radius: 50%;
}
.zoom-container input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: var(--rosa-principal);
    cursor: pointer;
    border-radius: 50%;
    border: none;
}
.zoom-container span {
    font-weight: 600;
    font-size: 14px;
    min-width: 45px;
    text-align: right;
}

/* --- PREVIEW DE MÚLTIPLES IMÁGENES --- */
#previewContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
}

.preview-item {
    position: relative;
    width: 120px;
    height: 120px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.preview-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.preview-item .remove-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255,0,0,0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* --- BARRA DE PROGRESO --- */
.progress-container {
    width: 100%;
    background-color: #f3f3f3;
    border-radius: 10px;
    margin: 15px 0;
    display: none;
}

.progress-bar {
    width: 0%;
    height: 20px;
    background: linear-gradient(45deg, #ff66b2, #66e0ff);
    border-radius: 10px;
    text-align: center;
    line-height: 20px;
    color: white;
    font-weight: 600;
    transition: width 0.3s ease;
}

/* --- BOTONES DE DESCARGA INDIVIDUAL --- */
.download-buttons {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.download-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    color: white;
    transition: all 0.2s;
}

.download-feed-btn {
    background: var(--verde-principal);
}

.download-feed-btn:hover {
    background: var(--verde-hover);
}

.download-historia-btn {
    background: var(--coral-principal);
}

.download-historia-btn:hover {
    background: var(--coral-hover);
}
</style>
</head>
<body>

<div id="login" class="pantalla h1">
  <img src="inicio.png" alt="Inicio" class="login-img">
  <h2>Bienvenida a la App de AndreStore</h2>
  <input type="text" id="usuario" placeholder="Usuario">
  <input type="password" id="clave" placeholder="Contraseña">
  <button onclick="login()">Ingresar y Empezar</button>
  <p id="error" style="color:#d63031; display:none; margin-top:10px;">Usuario o contraseña incorrectos</p>
</div>

<div id="app" class="pantalla" style="max-width:1100px;">
  <h1 style="text-align:center;">Generador de Feed & Historia</h1>
  <div style="height:30px;"></div> 
  
  <div class="image-upload-container">
    <label for="productoInput" class="custom-file-label">
      Selecciona una o varias imágenes
      <input type="file" id="productoInput" accept="image/*" multiple>
    </label>
    <div id="previewContainer"></div>
  </div>

  <div class="titulo-label2">
    <label for="codigo"><span><br>Código</span></label>
    <input type="text" id="codigo" placeholder="Ejemplo: ABC123">
  </div>
  
  <div class="titulo-label2">
    <label for="codigo"><span><br>Escoja la Talla<br></span></label>   
    <div class="size-buttons">
      <button onclick="selectSize(this,'Niña')">Niña</button>  
      <button onclick="selectSize(this,'Juvenil')">Juvenil</button>
      <button onclick="selectSize(this,'XS')">XS</button>
      <button onclick="selectSize(this,'S')">S</button>
      <button onclick="selectSize(this,'M')">M</button>
      <button onclick="selectSize(this,'L')">L</button>
      <button onclick="selectSize(this,'XL')">XL</button>
      <button onclick="selectSize(this,'Plus')">Plus</button>
      <button onclick="selectSize(this,'Plus 1X')">Plus 1X</button>
      <button onclick="selectSize(this,'Plus 2X')">Plus 2X</button>
      <button onclick="selectSize(this,'Plus 3X')">Plus 3X</button>
    </div>
  </div>
  
  <br>
  
  <div class="titulo-label2" style="display:flex; align-items:center; justify-content:center; gap:10px;">
    <div style="color:#ff00e1; font-weight:600;">Marco</div>
    <label class="switch">
      <input type="checkbox" id="toggleMarco" checked>
      <span class="slider"></span>
    </label>
  </div>
  
  <br>
  
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar">0%</div>
  </div>
  
  <div class="acciones">
    <div class="fila-actions">
      <button id="generarAmbosBtn">Generar Todas las Imágenes</button>
      <button id="descargarTodoBtn">Descargar Todo</button>
    </div>
    
    <div id="contenedorCanvases"></div>
  </div>
</div>

<script>
/* Mostrar login inicialmente */
document.getElementById("login").style.display = "block";

function login(){
  const user = document.getElementById("usuario").value.trim();
  const pass = document.getElementById("clave").value.trim();
  const error = document.getElementById("error");

  const USUARIO = "";
  const CLAVE = "";

  if(user === USUARIO && pass === CLAVE){
    document.getElementById("login").style.display = "none";
    document.getElementById("app").style.display = "block";
  } else {
    error.style.display = "block";
  }
}

/* Variables Globales */
const toggleMarco = document.getElementById("toggleMarco");
let tallaSeleccionada = "";
let currentImages = []; // Array para guardar múltiples imágenes
let generatedCanvases = []; // Array para guardar los canvases generados

/* Preview de múltiples imágenes */
document.getElementById('productoInput').addEventListener("change", e => {
  const files = e.target.files;
  const previewContainer = document.getElementById('previewContainer');
  previewContainer.innerHTML = '';
  
  if(files && files.length > 0) {
    for(let i = 0; i < files.length; i++) {
      const file = files[i];
      const reader = new FileReader();
      
      reader.onload = event => {
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';
        
        const img = document.createElement('img');
        img.src = event.target.result;
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.innerHTML = '×';
        removeBtn.onclick = function() {
          previewItem.remove();
          // También deberíamos eliminar el archivo del input, pero esto es complejo
        };
        
        previewItem.appendChild(img);
        previewItem.appendChild(removeBtn);
        previewContainer.appendChild(previewItem);
      };
      
      reader.readAsDataURL(file);
    }
  }
});

/* Selección de talla */
function selectSize(button,talla){
  document.querySelectorAll(".size-buttons button").forEach(b=>b.classList.remove("active"));
  button.classList.add("active");
  tallaSeleccionada = talla;
}

function dibujarProductoTexto(ctx, canvas, imgProducto, zoom = 1){
  const maxH = canvas.height * 0.90;
  const maxW = canvas.width * 0.90;
  let scale = Math.min(maxW / imgProducto.width, maxH / imgProducto.height);

  // Aplicar zoom extra para que se vea más grande
  scale *= zoom * 1.05; // +5% de tamaño extra

  // Ajuste específico para 1080x1080
  if(canvas.width === 1080 && canvas.height === 1080){
    scale *= 0.90;
  }

  const w = imgProducto.width * scale;
  const h = imgProducto.height * scale;

  const x = (canvas.width - w) / 2;
  // Subir la imagen un poco más: aumentar el valor restado
  const y = (canvas.height - h) / 2 - canvas.height * 0.10; // ahora sube más

  ctx.drawImage(imgProducto, x, y, w, h);
}

  /* Marco blanco con sombra (opcional) */
  if(toggleMarco.checked){
    const radius = 20, marco = 12;
    ctx.save();
    ctx.fillStyle = "#ffffff";
    ctx.shadowColor = "rgba(0,0,0,0.2)";
    ctx.shadowBlur = 26;
    ctx.shadowOffsetX = 8;
    ctx.shadowOffsetY = 8;
    ctx.beginPath();
    ctx.moveTo(x - marco + radius, y - marco);
    ctx.lineTo(x + w + marco - radius, y - marco);
    ctx.quadraticCurveTo(x + w + marco, y - marco, x + w + marco, y - marco + radius);
    ctx.lineTo(x + w + marco, y + h + marco - radius);
    ctx.quadraticCurveTo(x + w + marco, y + h + marco, x + w + marco - radius, y + h + marco);
    ctx.lineTo(x - marco + radius, y + h + marco);
    ctx.quadraticCurveTo(x - marco, y + h + marco, x - marco, y + h + marco - radius);
    ctx.lineTo(x - marco, y - marco + radius);
    ctx.quadraticCurveTo(x - marco, y - marco, x - marco + radius, y - marco);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  /* Recorte redondeado y producto */
  const radius = 22;
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + w - radius, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + radius);
  ctx.lineTo(x + w, y + h - radius);
  ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
  ctx.lineTo(x + radius, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
  ctx.clip();
  ctx.drawImage(imgProducto, x, y, w, h);
  ctx.restore();

  /* Texto Talla con efecto */
  ctx.save();
  const fontSize = Math.round(canvas.height * 0.06);
  ctx.font = `800 ${fontSize}px Poppins`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  const grad = ctx.createLinearGradient(0,0,canvas.width,0);
  grad.addColorStop(0,"#ffaadf");
  grad.addColorStop(1,"#e75480");
  ctx.fillStyle = grad;
  ctx.strokeStyle = "#ffffff";
  ctx.lineWidth = 8;
  ctx.shadowColor = "rgba(0,0,0,0.5)";
  ctx.shadowBlur = 10;
  ctx.shadowOffsetX = 4;
  ctx.shadowOffsetY = 4;
  const textoTalla = "Talla " + tallaSeleccionada;
  ctx.strokeText(textoTalla, canvas.width/2, canvas.height*0.92);
  ctx.fillText(textoTalla, canvas.width/2, canvas.height*0.92);
  ctx.restore();

  /* Código en esquina superior izquierda */
  ctx.save();
  ctx.font = `bold ${Math.round(canvas.height*0.012)}px Poppins`;
  ctx.fillStyle = "pink";
  ctx.textAlign = "left";
  ctx.textBaseline = "top";
  let codigoTexto = document.getElementById('codigo').value.trim();
  ctx.fillText("Código", 30, 35);
  ctx.fillText(codigoTexto, 30, 55);
  ctx.restore();
}

/* Dibuja fondo + contenido */
function dibujarCanvas(ctx, canvas, imgProducto, fondoSrc, width, height, zoom = 1){
  canvas.width = width;
  canvas.height = height;
  const fondo = new Image();
  fondo.src = fondoSrc;
  fondo.onload = ()=> {
    ctx.drawImage(fondo,0,0,canvas.width,canvas.height);
    dibujarProductoTexto(ctx, canvas, imgProducto, zoom);
  };
  fondo.onerror = ()=> {
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    dibujarProductoTexto(ctx, canvas, imgProducto, zoom);
  };
}

/* Validación */
function validarCampos(){
  if(!document.getElementById('productoInput').files[0]) { alert("Suba al menos una imagen del producto"); return false; }
  if(!tallaSeleccionada) { alert("Seleccione una talla"); return false; }
  if(!document.getElementById('codigo').value.trim()) { alert("Ingrese un código"); return false; }
  return true;
}

/* Generar todas las imágenes */
function generarTodas(){
  if(!validarCampos()) return;

  const fileInput = document.getElementById('productoInput');
  const files = fileInput.files;
  const contenedorCanvases = document.getElementById('contenedorCanvases');
  contenedorCanvases.innerHTML = '';
  generatedCanvases = [];
  
  // Mostrar barra de progreso
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  progressContainer.style.display = 'block';
  progressBar.style.width = '0%';
  progressBar.innerText = '0%';
  
  // Procesar cada imagen
  currentImages = [];
  let processed = 0;
  
  for(let i = 0; i < files.length; i++) {
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        currentImages.push(img);
        processed++;
        
        // Actualizar barra de progreso
        const progress = Math.round((processed / files.length) * 100);
        progressBar.style.width = progress + '%';
        progressBar.innerText = progress + '%';
        
        // Cuando todas las imágenes estén cargadas
        if(processed === files.length) {
          // Ocultar barra de progreso después de un breve momento
          setTimeout(() => {
            progressContainer.style.display = 'none';
          }, 500);
          
          // Generar los canvases para cada imagen
          generarCanvasesParaImagenes();
        }
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(files[i]);
  }
}

/* Generar canvases para todas las imágenes */
function generarCanvasesParaImagenes() {
  const contenedorCanvases = document.getElementById('contenedorCanvases');
  contenedorCanvases.innerHTML = '';
  generatedCanvases = [];
  
  // Crear sección para Feeds
  const feedRow = document.createElement('div');
  feedRow.className = 'canvas-row';
  
  const feedTitle = document.createElement('div');
  feedTitle.className = 'canvas-row-title feed-title';
  feedTitle.innerText = 'Feeds';
  feedRow.appendChild(feedTitle);
  
  const feedScrollContainer = document.createElement('div');
  feedScrollContainer.className = 'canvas-scroll-container';
  
  const feedHorizontalContainer = document.createElement('div');
  feedHorizontalContainer.className = 'canvas-horizontal-container';
  feedScrollContainer.appendChild(feedHorizontalContainer);
  feedRow.appendChild(feedScrollContainer);
  
  // Crear sección para Historias
  const historiaRow = document.createElement('div');
  historiaRow.className = 'canvas-row';
  
  const historiaTitle = document.createElement('div');
  historiaTitle.className = 'canvas-row-title historia-title';
  historiaTitle.innerText = 'Historias';
  historiaRow.appendChild(historiaTitle);
  
  const historiaScrollContainer = document.createElement('div');
  historiaScrollContainer.className = 'canvas-scroll-container';
  
  const historiaHorizontalContainer = document.createElement('div');
  historiaHorizontalContainer.className = 'canvas-horizontal-container';
  historiaScrollContainer.appendChild(historiaHorizontalContainer);
  historiaRow.appendChild(historiaScrollContainer);
  
  // Añadir secciones al contenedor principal
  contenedorCanvases.appendChild(feedRow);
  contenedorCanvases.appendChild(historiaRow);
  
  // Generar cada imagen
  currentImages.forEach((img, index) => {
    // Contenedor para esta imagen (Feed)
    const feedContainer = document.createElement('div');
    feedContainer.className = 'canvas-container';
    
    // Título para la imagen
    const tituloFeed = document.createElement('div');
    tituloFeed.style.fontFamily = "'Poppins', sans-serif";
    tituloFeed.style.color = "#54f983";
    tituloFeed.style.fontWeight = "600";
    tituloFeed.style.textAlign = "center";
    tituloFeed.style.fontSize = "1rem";
    tituloFeed.style.marginBottom = "10px";
    tituloFeed.innerText = `Imagen ${index + 1}`;
    feedContainer.appendChild(tituloFeed);
    
    // Canvas para Feed
    const canvasFeed = document.createElement('canvas');
    canvasFeed.id = `canvasFeed-${index}`;
    canvasFeed.width = 400;
    canvasFeed.height = 400;
    feedContainer.appendChild(canvasFeed);
    
    // Controles de zoom para Feed
    const zoomContainerFeed = document.createElement('div');
    zoomContainerFeed.className = 'zoom-container';
    
    const zoomLabelFeed = document.createElement('label');
    zoomLabelFeed.htmlFor = `zoomFeed-${index}`;
    zoomLabelFeed.innerText = 'Zoom:';
    zoomContainerFeed.appendChild(zoomLabelFeed);
    
    const zoomSliderFeed = document.createElement('input');
    zoomSliderFeed.type = 'range';
    zoomSliderFeed.id = `zoomFeed-${index}`;
    zoomSliderFeed.min = '0.5';
    zoomSliderFeed.max = '2.5';
    zoomSliderFeed.value = '1';
    zoomSliderFeed.step = '0.05';
    zoomContainerFeed.appendChild(zoomSliderFeed);
    
    const zoomValueFeed = document.createElement('span');
    zoomValueFeed.id = `zoomFeedValue-${index}`;
    zoomValueFeed.innerText = '100%';
    zoomContainerFeed.appendChild(zoomValueFeed);
    
    feedContainer.appendChild(zoomContainerFeed);
    
    // Botones de descarga para Feed
    const downloadButtons = document.createElement('div');
    downloadButtons.className = 'download-buttons';
    
    const downloadFeedBtn = document.createElement('button');
    downloadFeedBtn.className = 'download-btn download-feed-btn';
    downloadFeedBtn.innerText = 'Descargar Feed';
    downloadFeedBtn.onclick = () => descargarImagen(index, 'feed');
    downloadButtons.appendChild(downloadFeedBtn);
    
    feedContainer.appendChild(downloadButtons);
    
    // Añadir feed al contenedor horizontal
    feedHorizontalContainer.appendChild(feedContainer);
    
    // Contenedor para esta imagen (Historia)
    const historiaContainer = document.createElement('div');
    historiaContainer.className = 'canvas-container';
    
    // Título para la imagen
    const tituloHistoria = document.createElement('div');
    tituloHistoria.style.fontFamily = "'Poppins', sans-serif";
    tituloHistoria.style.color = "#e98e1e";
    tituloHistoria.style.fontWeight = "600";
    tituloHistoria.style.textAlign = "center";
    tituloHistoria.style.fontSize = "1rem";
    tituloHistoria.style.marginBottom = "10px";
    tituloHistoria.innerText = `Imagen ${index + 1}`;
    historiaContainer.appendChild(tituloHistoria);
    
    // Canvas para Historia
    const canvasHistoria = document.createElement('canvas');
    canvasHistoria.id = `canvasHistoria-${index}`;
    canvasHistoria.width = 225; // 9:16 aspect ratio
    canvasHistoria.height = 400;
    historiaContainer.appendChild(canvasHistoria);
    
    // Controles de zoom para Historia
    const zoomContainerHistoria = document.createElement('div');
    zoomContainerHistoria.className = 'zoom-container';
    
    const zoomLabelHistoria = document.createElement('label');
    zoomLabelHistoria.htmlFor = `zoomHistoria-${index}`;
    zoomLabelHistoria.innerText = 'Zoom:';
    zoomContainerHistoria.appendChild(zoomLabelHistoria);
    
    const zoomSliderHistoria = document.createElement('input');
    zoomSliderHistoria.type = 'range';
    zoomSliderHistoria.id = `zoomHistoria-${index}`;
    zoomSliderHistoria.min = '0.5';
    zoomSliderHistoria.max = '2.5';
    zoomSliderHistoria.value = '1';
    zoomSliderHistoria.step = '0.05';
    zoomContainerHistoria.appendChild(zoomSliderHistoria);
    
    const zoomValueHistoria = document.createElement('span');
    zoomValueHistoria.id = `zoomHistoriaValue-${index}`;
    zoomValueHistoria.innerText = '100%';
    zoomContainerHistoria.appendChild(zoomValueHistoria);
    
    historiaContainer.appendChild(zoomContainerHistoria);
    
    // Botones de descarga para Historia
    const downloadButtonsHistoria = document.createElement('div');
    downloadButtonsHistoria.className = 'download-buttons';
    
    const downloadHistoriaBtn = document.createElement('button');
    downloadHistoriaBtn.className = 'download-btn download-historia-btn';
    downloadHistoriaBtn.innerText = 'Descargar Historia';
    downloadHistoriaBtn.onclick = () => descargarImagen(index, 'historia');
    downloadButtonsHistoria.appendChild(downloadHistoriaBtn);
    
    historiaContainer.appendChild(downloadButtonsHistoria);
    
    // Añadir historia al contenedor horizontal
    historiaHorizontalContainer.appendChild(historiaContainer);
    
    // Dibujar los canvases
    dibujarCanvas(
      canvasFeed.getContext('2d'),
      canvasFeed,
      img, 
      './fondo.png',
      400,
      400,
      1
    );
    
    dibujarCanvas(
      canvasHistoria.getContext('2d'),
      canvasHistoria,
      img, 
      './fondo2.png',
      225,
      400,
      1
    );
    
    // Guardar referencias a los canvases
    generatedCanvases.push({
      feed: canvasFeed,
      historia: canvasHistoria,
      zoomFeed: 1,
      zoomHistoria: 1
    });
    
    // Configurar eventos para los sliders de zoom
    zoomSliderFeed.addEventListener('input', (e) => {
      const zoom = parseFloat(e.target.value);
      generatedCanvases[index].zoomFeed = zoom;
      zoomValueFeed.innerText = `${Math.round(zoom * 100)}%`;
      
      dibujarCanvas(
        canvasFeed.getContext('2d'),
        canvasFeed,
        img, 
        './fondo.png',
        400,
        400,
        zoom
      );
    });
    
    zoomSliderHistoria.addEventListener('input', (e) => {
      const zoom = parseFloat(e.target.value);
      generatedCanvases[index].zoomHistoria = zoom;
      zoomValueHistoria.innerText = `${Math.round(zoom * 100)}%`;
      
      dibujarCanvas(
        canvasHistoria.getContext('2d'),
        canvasHistoria,
        img, 
        './fondo2.png',
        225,
        400,
        zoom
      );
    });
  });
}

/* Descargar una imagen específica */
function descargarImagen(index, tipo){
  if(!validarCampos()) return;
  
  const codigo = document.getElementById('codigo').value.trim();
  const fecha = new Date();
  const fechaStr = fecha.getFullYear() + ('0'+(fecha.getMonth()+1)).slice(-2) + ('0'+fecha.getDate()).slice(-2);
  
  let canvas, nombre;
  
  if(tipo === 'feed') {
    canvas = document.createElement('canvas');
    canvas.width = 1080;
    canvas.height = 1080;
    const ctx = canvas.getContext('2d');
    dibujarCanvas(
      ctx,
      canvas,
      currentImages[index], 
      './fondo.png',
      1080,
      1080,
      generatedCanvases[index].zoomFeed
    );
    
    // Esperar a que se renderice
    setTimeout(() => {
      nombre = `FEED_${tallaSeleccionada}_${codigo}_${index+1}_${fechaStr}.png`;
      const link = document.createElement('a');
      link.download = nombre;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }, 100);
  } else {
    canvas = document.createElement('canvas');
    canvas.width = 1080;
    canvas.height = 1920;
    const ctx = canvas.getContext('2d');
    dibujarCanvas(
      ctx,
      canvas,
      currentImages[index], 
      './fondo2.png',
      1080,
      1920,
      generatedCanvases[index].zoomHistoria
    );
    
    // Esperar a que se renderice
    setTimeout(() => {
      nombre = `HISTORIA_${tallaSeleccionada}_${codigo}_${index+1}_${fechaStr}.png`;
      const link = document.createElement('a');
      link.download = nombre;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }, 100);
  }
}

/* Descargar todas las imágenes */
function descargarTodo(){
  if(!validarCampos() || generatedCanvases.length === 0) return;
  
  const codigo = document.getElementById('codigo').value.trim();
  const fecha = new Date();
  const fechaStr = fecha.getFullYear() + ('0'+(fecha.getMonth()+1)).slice(-2) + ('0'+fecha.getDate()).slice(-2);
  
  // Implementación simplificada: descargar una por una
  for(let i = 0; i < generatedCanvases.length; i++) {
    // Descargar feed
    setTimeout(() => {
      const canvasFeed = document.createElement('canvas');
      canvasFeed.width = 1080;
      canvasFeed.height = 1080;
      const ctxFeed = canvasFeed.getContext('2d');
      dibujarCanvas(
        ctxFeed,
        canvasFeed,
        currentImages[i], 
        './fondo.png',
        1080,
        1080,
        generatedCanvases[i].zoomFeed
      );
      
      setTimeout(() => {
        const linkFeed = document.createElement('a');
        linkFeed.download = `FEED_${tallaSeleccionada}_${codigo}_${i+1}_${fechaStr}.png`;
        linkFeed.href = canvasFeed.toDataURL('image/png');
        linkFeed.click();
      }, 200);
    }, i * 1000);
    
    // Descargar historia
    setTimeout(() => {
      const canvasHistoria = document.createElement('canvas');
      canvasHistoria.width = 1080;
      canvasHistoria.height = 1920;
      const ctxHistoria = canvasHistoria.getContext('2d');
      dibujarCanvas(
        ctxHistoria,
        canvasHistoria,
        currentImages[i], 
        './fondo2.png',
        1080,
        1920,
        generatedCanvases[i].zoomHistoria
      );
      
      setTimeout(() => {
        const linkHistoria = document.createElement('a');
        linkHistoria.download = `HISTORIA_${tallaSeleccionada}_${codigo}_${i+1}_${fechaStr}.png`;
        linkHistoria.href = canvasHistoria.toDataURL('image/png');
        linkHistoria.click();
      }, 200);
    }, i * 1000 + 500);
  }
  
  alert(`Se descargarán ${generatedCanvases.length * 2} imágenes. Esto puede tomar unos momentos.`);
}

/* Listeners */
document.getElementById('generarAmbosBtn').addEventListener('click', generarTodas);
document.getElementById('descargarTodoBtn').addEventListener('click', descargarTodo);
</script>

<footer>
    <small>
        &copy; 2025 Todos los derechos reservados. <br>
        Powered and developed by <strong>ENG</strong> for <strong>DAIDSM</strong>
    </small>
</footer>
</body>
</html>
.

